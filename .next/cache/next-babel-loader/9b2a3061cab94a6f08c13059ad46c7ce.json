{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from \"react\";\nimport { Flex, Text, Box, Button, Row, Column } from \"rebass\";\nimport Table, { TableLine, ProductInfo } from \"./base-table\";\nimport EditBox from \"../made-edit-box\";\nimport ShowStyle from \"../show-style\";\nimport request from \"../../utils/request\";\nexport default (function (props) {\n  var _useState = useState(false),\n      showEditBox = _useState[0],\n      setShowEditBox = _useState[1];\n\n  var _useState2 = useState(0),\n      editIndex = _useState2[0],\n      setEditIndex = _useState2[1];\n\n  var mode = \"POSITIVE\";\n\n  var _useState3 = useState([]),\n      collectList = _useState3[0],\n      setCollectList = _useState3[1];\n\n  var _useState4 = useState([]),\n      collectDetailsList = _useState4[0],\n      setCollectDetailsList = _useState4[1];\n\n  var _useState5 = useState([]),\n      selectList = _useState5[0],\n      setSelectList = _useState5[1];\n\n  var getCollectList =\n  /*#__PURE__*/\n  function () {\n    var _ref = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var res, data;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return request(\"/user/getFavoriteList\");\n\n            case 2:\n              res = _context.sent;\n\n              if (res) {\n                _context.next = 5;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 5:\n              data = res.map(function (item) {\n                var prodInfo = [];\n                var price = [];\n                var style = [];\n                var colorInfo = [];\n                var date = [];\n                var details = [];\n                var threeViews = item.styleAndColor.map(function (x) {\n                  details.push(x.style);\n                  prodInfo.push({\n                    styleNo: x.style.styleNo,\n                    id: x.style._id\n                  });\n                  price.push(x.style.price);\n                  date.push(x.style.updateTime);\n                  colorInfo.push({\n                    colorId: x.color._id,\n                    imgUrl: x.front\n                  }); // let positive = x.\n\n                  return {\n                    POSITIVE: x.front\n                  }; // style.push(item.styleNo)\n                });\n                collectDetailsList.push(details);\n                setCollectDetailsList([].concat(collectDetailsList));\n                return {\n                  id: item._id,\n                  colorInfo: colorInfo,\n                  threeViews: threeViews,\n                  prodInfo: prodInfo,\n                  price: price,\n                  style: style,\n                  date: date\n                };\n              });\n              setCollectList(data);\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function getCollectList() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    getCollectList();\n  }, []);\n\n  var handleSelect = function handleSelect(index, item) {\n    var pos = selectList.findIndex(function (x) {\n      return x.index === index;\n    });\n\n    if (pos < 0) {\n      selectList.push(_objectSpread({\n        index: index\n      }, item, {\n        details: collectDetailsList[index]\n      }));\n    } else {\n      selectList.splice(pos, 1);\n    }\n\n    setSelectList([].concat(selectList));\n  };\n\n  var handleDel =\n  /*#__PURE__*/\n  function () {\n    var _ref2 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee2(index, item) {\n      var res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              console.log(item);\n              _context2.next = 3;\n              return request(\"/user/deleteFavorite\", {\n                _id: item.id\n              }, \"post\");\n\n            case 3:\n              res = _context2.sent;\n\n              // console.log(\"res\", res)\n              if (res) {\n                console.log(\"删除他，嘿嘿嘿\");\n                collectList.splice(index, 1);\n                setCollectList([].concat(collectList));\n              }\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleDel(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleConfirmMade =\n  /*#__PURE__*/\n  function () {\n    var _ref3 = _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee3(colorIds, imgUrls) {\n      var params, res;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (colorIds[0]) {\n                _context3.next = 2;\n                break;\n              }\n\n              return _context3.abrupt(\"return\");\n\n            case 2:\n              params = [{\n                styleId: collectList[editIndex].prodInfo[0].id,\n                colorId: colorIds[0]\n              }];\n\n              if (collectList[editIndex].length > 1) {\n                // if (! > 2) return\n                params.push({\n                  styleId: collectList[editIndex].prodInfo[1].id,\n                  colorId: colorIds[1]\n                });\n              }\n\n              _context3.next = 6;\n              return request(\"/user/updateFavorite\", {\n                _id: collectList[editIndex].id,\n                styleAndColor: params\n              }, \"post\");\n\n            case 6:\n              res = _context3.sent;\n\n              // setStyleDetails([].concat(styleDetails))\n              if (res) {\n                getCollectList();\n              }\n\n            case 8:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function handleConfirmMade(_x3, _x4) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return collectList.length > 0 ? __jsx(Flex, {\n    flexDirection: \"column\",\n    justifyContent: \"space-between\",\n    sx: {\n      cursor: \"pointer\",\n      height: \"100%\",\n      background: \"#FFF0E5\"\n    }\n  }, __jsx(Table, {\n    titles: [{\n      name: \"00\",\n      width: \"2/22\",\n      isHide: true\n    }, {\n      name: \"PICTRUE\",\n      width: \"2/22\"\n    }, {\n      name: \"PRODUCT INFOMATION\",\n      width: \"4/22\"\n    }, {\n      name: \"PRICE\",\n      width: \"1/22\"\n    }, {\n      name: \"DATE\",\n      width: \"2/22\"\n    }, {\n      name: \"STYLE\",\n      width: \"1/22\"\n    }, {\n      name: \"EDIT\",\n      width: \"5/22\"\n    }]\n  }, collectList.map(function (collect, index) {\n    return __jsx(TableLine, {\n      isSelect: selectList.findIndex(function (x) {\n        return index === x.index;\n      }) >= 0,\n      haveSelect: true,\n      onSelect: function onSelect() {\n        handleSelect(index, collect);\n      },\n      haveDel: true,\n      onDel: function onDel() {\n        handleDel(index, collect);\n      },\n      haveEdit: true,\n      onEdit: function onEdit() {\n        setEditIndex(index);\n        setShowEditBox(true);\n      }\n    }, __jsx(Text, {\n      style: {\n        position: \"absolute\"\n      }\n    }, index + 1), __jsx(ShowStyle // width=\"2rem\"\n    , {\n      key: collect.id,\n      imgWidth: \"0.95rem\",\n      mode: mode,\n      threeViews: collect.threeViews,\n      border: \"none\",\n      hideInfo: true\n    }), __jsx(Flex, {\n      justifyContent: \"center\"\n    }, __jsx(Box, {\n      margin: \"8px 0\"\n    }, collect.prodInfo.map(function (prodInfo) {\n      return __jsx(ProductInfo, {\n        styleNum: prodInfo.styleNo,\n        made: \"2110 YE GREEN/2001 YE GREEN\"\n      });\n    }))), __jsx(Flex, {\n      flexDirection: \"column\"\n    }, collect.price.map(function (price) {\n      return __jsx(Text, {\n        p: \"4px 0\"\n      }, price);\n    })), __jsx(Flex, {\n      flexDirection: \"column\"\n    }, collect.date.map(function (date) {\n      return __jsx(Text, {\n        p: \"4px 0\"\n      }, date);\n    })), __jsx(Flex, {\n      flexDirection: \"column\"\n    }, __jsx(Text, null, \"TOPS\"), __jsx(Text, null, \"BOTTOMS\")));\n  })), __jsx(Button, {\n    variant: \"primary\",\n    height: \"1.13rem\",\n    width: \"19.2rem\",\n    bg: \"#000\",\n    color: \"#fff\",\n    padding: \"0\",\n    sx: {\n      borderRadius: 0,\n      fontSize: \"0.27rem\",\n      cursor: \"pointer\"\n    },\n    onClick: function onClick() {\n      props.nextStep(selectList);\n    }\n  }, \"GENERATE ORDERS\"), showEditBox ? __jsx(EditBox, {\n    styleDetails: collectDetailsList[editIndex],\n    curStyle: collectList[editIndex].colorInfo,\n    confirmMade: handleConfirmMade,\n    onClose: function onClose() {\n      setShowEditBox(false);\n    }\n  }) : null) : null;\n});","map":null,"metadata":{},"sourceType":"module"}